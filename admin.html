
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thời Khóa Biểu</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 300px; }
        input, button { padding: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Quản lý Thời Khóa Biểu</h1>
    <div id="login">
        <input type="text" id="username" placeholder="Tên đăng nhập"><br>
        <input type="password" id="password" placeholder="Mật khẩu"><br>
        <button onclick="login()">Đăng nhập</button>
    </div>
    <div id="editor" style="display:none;">
        <textarea id="jsonData"></textarea><br>
        <button onclick="save()">Lưu</button>
    </div>

    <script>
        const RAW_URL = "https://raw.githubusercontent.com/ductrong49/8a9/refs/heads/main/tkb.json";
        const API_URL = "https://api.github.com/repos/ductrong49/8a9/contents/tkb.json";
        const TOKEN = "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";
        const USER = "ductrong49";
        const PASS = "Ductrong123";
        let shaValue = "";

        async function login() {
            let u = document.getElementById("username").value;
            let p = document.getElementById("password").value;
            if (u === USER && p === PASS) {
                document.getElementById("login").style.display = "none";
                document.getElementById("editor").style.display = "block";
                loadData();
            } else {
                alert("Sai tài khoản hoặc mật khẩu!");
            }
        }

        async function loadData() {
            let res = await fetch(API_URL, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            let data = await res.json();
            shaValue = data.sha;
            let content = atob(data.content);
            document.getElementById("jsonData").value = content;
        }

        async function save() {
            let newContent = document.getElementById("jsonData").value;
            let res = await fetch(API_URL, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${TOKEN}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: "Cập nhật tkb.json từ web",
                    content: btoa(newContent),
                    sha: shaValue
                })
            });
            if (res.ok) {
                alert("Đã lưu thành công!");
                loadData();
            } else {
                alert("Lỗi lưu dữ liệu!");
            }
        }
    </script>
</body>
</html>
