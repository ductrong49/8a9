<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Thời Khóa Biểu</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #loginSection, #mainSection { max-width: 600px; margin: auto; }
    #mainSection { display: none; }
    textarea { width: 100%; height: 300px; }
    button { padding: 10px 20px; margin-top: 10px; }
</style>
</head>
<body>

<div id="loginSection">
    <h2>Đăng nhập để chỉnh sửa TKB</h2>
    <input type="password" id="password" placeholder="Nhập mật khẩu"><br>
    <button onclick="login()">Đăng nhập</button>
</div>

<div id="mainSection">
    <h2>Thời Khóa Biểu</h2>
    <textarea id="jsonData"></textarea><br>
    <button onclick="saveData()">Lưu dữ liệu</button>
    <p id="status"></p>
</div>

<script>
const GITHUB_TOKEN = "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";
const REPO_OWNER = "ductrong49";
const REPO_NAME = "8a9";
const FILE_PATH = "tkb.json";
const BRANCH = "main";
const PASSWORD = "Ductrong123";

function login() {
    const pass = document.getElementById("password").value;
    if (pass === PASSWORD) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("mainSection").style.display = "block";
        loadData();
    } else {
        alert("Sai mật khẩu!");
    }
}

async function loadData() {
    const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/${FILE_PATH}`;
    const response = await fetch(url);
    const text = await response.text();
    document.getElementById("jsonData").value = text;
}

async function saveData() {
    const newContent = document.getElementById("jsonData").value;
    const getUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
    
    const getRes = await fetch(getUrl, { headers: { Authorization: `token ${GITHUB_TOKEN}` } });
    const fileData = await getRes.json();
    const sha = fileData.sha;

    const putRes = await fetch(getUrl, {
        method: "PUT",
        headers: {
            "Authorization": `token ${GITHUB_TOKEN}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Cập nhật TKB",
            content: btoa(unescape(encodeURIComponent(newContent))),
            sha: sha,
            branch: BRANCH
        })
    });

    if (putRes.ok) {
        document.getElementById("status").innerText = "Đã lưu thành công!";
    } else {
        document.getElementById("status").innerText = "Lỗi khi lưu dữ liệu!";
    }
}
</script>

</body>
</html>
